-- SQL Instance Name:  smg-sql01
if (@@SERVERNAME != 'smg-dsdev05')
begin
print 'Invalid SQL Server Connection'
return
end

USE [SUPPORT];

IF EXISTS (
    SELECT * FROM sysobjects WHERE id = object_id(N'sl.fn_ParseStringReturningDecimal') 
    AND xtype IN (N'FN', N'IF', N'TF')
)
DROP FUNCTION [sl].[fn_ParseStringReturningDecimal]
GO
-- create function scalar-valued 
CREATE FUNCTION [sl].[fn_ParseStringReturningDecimal] 
(
    @inputString [nvarchar] (30) 
)
RETURNS [decimal] (10, 4)
AS
BEGIN  
  DECLARE @returnDecimal [decimal] (10, 4)  = 0;
  DECLARE @numeratorString [nvarchar] (30) = '';
  DECLARE @denominatorString [nvarchar] (30) = '';
  DECLARE @numeratorDecimal [decimal] (10,4) = 0;
  DECLARE @denominatorDecimal [decimal] (10,4) = 0;
  
  IF (CHARINDEX('.', @inputString) > 1) BEGIN
    SET @numeratorString = SUBSTRING (@inputString, 1, CHARINDEX('.', @inputString) - 1);
    IF (ISNUMERIC (@numeratorString) = 0) BEGIN
      RETURN @returnDecimal;
    END
    SET @denominatorString = SUBSTRING (@inputString, CHARINDEX('.', @inputString) + 1, LEN(@inputString) - CHARINDEX('.', @inputString));
    IF (ISNUMERIC (@denominatorString) = 0) BEGIN
      RETURN @returnDecimal
    END
    
    -- Get Decimal part of string; Account for the decimal's being to four places.
	SET @denominatorString = @denominatorString + REPLICATE('0', 4 - LEN(@denominatorString)); 


    -- Convert the whole part of the string to a decimal.
    SET @numeratorDecimal = CONVERT ([decimal] (10, 4), @numeratorString);
    
    -- Convert the Decimal part of the string to a decimal.
    SET @denominatorDecimal = CONVERT ([decimal] (10, 4), @denominatorString);
    
    -- Account for the decimal's being to four places.
	SET @denominatorDecimal = (@denominatorDecimal/10000);
    
    -- Add the Whole Part of the string to the decimal portion of the string.
    SET @returnDecimal = @numeratorDecimal + @denominatorDecimal;
    
  END
  
  -- If the input string represents a whole number
  ELSE BEGIN
    SET @returnDecimal = CONVERT([decimal] (10, 4), @inputString);
  END

  RETURN @returnDecimal;

END